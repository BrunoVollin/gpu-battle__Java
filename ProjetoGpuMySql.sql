-- MySQL Script generated by MySQL Workbench
-- Tue Dec 15 18:23:22 2020
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema gpubd
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema gpubd
-- -----------------------------------------------------
drop SCHEMA IF EXISTS `gpubd`;
CREATE SCHEMA IF NOT EXISTS `gpubd` DEFAULT CHARACTER SET utf8 ;
USE `gpubd` ;

-- -----------------------------------------------------
-- Table `gpubd`.`Cpu`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `gpubd`.`Cpu` (
  `Cores` INT NULL,
  `threads` INT NULL,
  `ClocksCpu` FLOAT NULL,
  `nameCpu` VARCHAR(45) NOT NULL,
  `brandCpu` VARCHAR(45) NULL,
  `costCpu` FLOAT NULL,
  `memoryCpu` INT NULL,
  PRIMARY KEY (`nameCpu`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `gpubd`.`Gpu`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `gpubd`.`Gpu` (
  `madeBy` VARCHAR(45) NULL,
  `vRam` FLOAT NULL,
  `ClocksGpu` FLOAT NULL,
  `nameGpu` VARCHAR(45) NOT NULL,
  `brandGpu` VARCHAR(45) NULL,
  `costGpu` FLOAT NULL,
  `memoryGpu` INT NULL,
  PRIMARY KEY (`nameGpu`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `gpubd`.`PC`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `gpubd`.`PC` (
  `costPc` FLOAT NULL,
  `namePc` VARCHAR(45) NOT NULL,
  `Cpu_nameCpu` VARCHAR(45) NOT NULL,
  `Gpu_nameGpu` VARCHAR(45) NOT NULL,
  INDEX `fk_PC_Cpu1_idx` (`Cpu_nameCpu` ASC) VISIBLE,
  INDEX `fk_PC_Gpu1_idx` (`Gpu_nameGpu` ASC) VISIBLE,
  PRIMARY KEY (`namePc`),
  CONSTRAINT `fk_PC_Cpu1`
    FOREIGN KEY (`Cpu_nameCpu`)
    REFERENCES `gpubd`.`Cpu` (`nameCpu`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_PC_Gpu1`
    FOREIGN KEY (`Gpu_nameGpu`)
    REFERENCES `gpubd`.`Gpu` (`nameGpu`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `gpubd`.`Game`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `gpubd`.`Game` (
  `nameGame` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`nameGame`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `gpubd`.`Test`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `gpubd`.`Test` (
  `fps` INT NULL,
  `nameTest` VARCHAR(70) NOT NULL,
  `PC_namePc` VARCHAR(45) NOT NULL,
  `Game_nameGame` VARCHAR(45) NOT NULL,
  INDEX `fk_Test_PC1_idx` (`PC_namePc` ASC) VISIBLE,
  PRIMARY KEY (`nameTest`),
  INDEX `fk_Test_Game1_idx` (`Game_nameGame` ASC) VISIBLE,
  CONSTRAINT `fk_Test_PC1`
    FOREIGN KEY (`PC_namePc`)
    REFERENCES `gpubd`.`PC` (`namePc`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Test_Game1`
    FOREIGN KEY (`Game_nameGame`)
    REFERENCES `gpubd`.`Game` (`nameGame`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `gpubd`.`Developer`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `gpubd`.`Developer` (
  `name` VARCHAR(45) NOT NULL,
  `city` VARCHAR(45) NULL,
  `Game_nameGame` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`name`),
  INDEX `fk_Developer_Game1_idx` (`Game_nameGame` ASC) VISIBLE,
  CONSTRAINT `fk_Developer_Game1`
    FOREIGN KEY (`Game_nameGame`)
    REFERENCES `gpubd`.`Game` (`nameGame`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `gpubd`.`Profile`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `gpubd`.`Profile` (
  `Login` VARCHAR(45) NOT NULL,
  `password` VARCHAR(45) NULL,
  PRIMARY KEY (`Login`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `gpubd`.`PC_has_Game`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `gpubd`.`PC_has_Game` (
  `PC_namePc` VARCHAR(45) NOT NULL,
  `Game_nameGame` VARCHAR(70) NOT NULL,
  PRIMARY KEY (`PC_namePc`, `Game_nameGame`),
  INDEX `fk_PC_has_Game_Game1_idx` (`Game_nameGame` ASC) VISIBLE,
  INDEX `fk_PC_has_Game_PC1_idx` (`PC_namePc` ASC) VISIBLE,
  CONSTRAINT `fk_PC_has_Game_PC1`
    FOREIGN KEY (`PC_namePc`)
    REFERENCES `gpubd`.`PC` (`namePc`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_PC_has_Game_Game1`
    FOREIGN KEY (`Game_nameGame`)
    REFERENCES `gpubd`.`Game` (`nameGame`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;


-- -----------------------------------------------------
-- Inserindo 
-- -----------------------------------------------------

-- gpu
insert into gpu(nameGpu, brandGpu, costGpu) values('GTX 1050', 'Nvidia', 599); -- Davizao fazer igual esse
insert into gpu(nameGpu,  brandGpu, costGpu) values('GTX 1080 Ti SC2','NVIDIA', 4612.31);
insert into gpu(nameGpu, brandGpu, costGpu) values('RTX 2080 FE','NVIDIA',4588.12);
insert into gpu(nameGpu, brandGpu, costGpu) values('GTX 1050 Ti','NVIDIA',1258.71);
insert into gpu(nameGpu, brandGpu, costGpu) values('GTX 1060 3GB','NVIDIA',1566.84);

-- cpu
insert into cpu(nameCpu, brandCpu, costCpu) values('CORE I3 8100', 'Intel', 918.06);
insert into cpu(nameCpu, brandCpu, costCpu) values('CORE I7 8700','Intel',2435.90);
insert into cpu(nameCpu, brandCpu, costCpu) values('CORE I5 8400','Intel',1403.90);
insert into cpu(nameCpu, brandCpu, costCpu) values('Ryzen 7 2700','AMD',1399.99);


-- game
insert into game(nameGame) values('Far Cry 5');
insert into developer(name, city, Game_nameGame) 
values('Ubisoft Montreal', 'Montreal, Canada', 'Far Cry 5');  

insert into game(nameGame) values('Assassin´s creed: Origins');
insert into developer(name, city, Game_nameGame) 
values('Ubisoft Montreal.', 'Montreal, Canada', 'Assassin´s creed: Origins');  

insert into game(nameGame) values('Gta 5');
insert into developer(name, city, Game_nameGame) 
values('Rockstar Games', 'New York, United States', 'Gta 5');  


-- pc


/*
DELIMITER $
 CREATE FUNCTION  setPrecoPc(nGpu varchar(45), nCpu varchar(45)) RETURNS float
 BEGIN
	declare p float;
    select  (costGpu + costCpu) from Cpu, Gpu where nomeGpu = nGpu and nomeCpu = nCpu;
  RETURN p;
 END
 $
select setPrecoPc('GTX 1050', 'CORE I3 8100');
*/



DELIMITER $$
CREATE PROCEDURE inserirPc(nGpu varchar(45), nCpu varchar(45))
BEGIN
	declare p float;
    set p = (select (costGpu + costCpu) from Cpu, Gpu where nameGpu = nGpu and nameCpu = nCpu);
    insert into pc(namePc, Cpu_nameCpu, Gpu_nameGpu, costPc) 
	values (concat(nGpu, concat(' + ', nCpu)), nCpu, nGpu, p);
END $$
DELIMITER ;
select * FROM PC;

call inserirPc('GTX 1050', 'CORE I3 8100');
call inserirPc('GTX 1080 Ti SC2', 'CORE I7 8700');
call inserirPc('GTX 1050 Ti', 'Ryzen 7 2700');
call inserirPc('GTX 1060 3GB', 'CORE I5 8400');
call inserirPc('RTX 2080 FE', 'CORE I3 8100');

select * from pc;

DELIMITER $$
CREATE PROCEDURE inserirTest (nomePcnn varchar(70), fpsF int, fpG int, fpA int)
BEGIN

	IF fpsF > 60 THEN 
		insert into pc_has_game values(nomePcnn, 'Far Cry 5');	
	END IF;
    
    IF fpsG > 60 THEN 
		insert into pc_has_game values(nomePcnn, 'Gta 5');	
	END IF;
    
    IF fpsA > 60 THEN 
		insert into pc_has_game values(nomePcnn, 'Assassin´s creed: Origins');	
	END IF;
  
    insert into test(nameTest, Pc_namePc, Game_nameGame, fps) 
	values(concat(nomePcnn, ' on Far Cry 5'), nomePcnn, 'Far Cry 5',  fpsF);
	insert into test(nameTest, Pc_namePc, Game_nameGame, fps) 
	values(concat(nomePcnn, ' on Gta 5'), nomePcnn, 'Gta 5',  fpG);
	insert into test(nameTest, Pc_namePc, Game_nameGame, fps) 
	values(concat(nomePcnn, ' on Assassin´s creed: Origins'), nomePcnn, 'Assassin´s creed: Origins',  fpA);
END $$
DELIMITER ;


call inserirTest('GTX 1050 + CORE I3 8100', 35, 45, 37);
call inserirTest('GTX 1080 Ti SC2 + CORE I7 8700', 113, 91, 106);
call inserirTest('GTX 1050 Ti + Ryzen 7 2700', 44, 50, 44);
call inserirTest('GTX 1060 3GB + CORE I5 8400', 66, 73, 58);
call inserirTest('RTX 2080 FE + CORE I3 8100', 102, 79, 71);

-- insert into pc_has_game values('GTX 1080 Ti SC2 + CORE I7 8700', 'Far Cry 5');

select * from pc_has_game;

select * from pc;

select * from game, developer where nameGame = "Far Cry 5" and nameGame = Game_nameGame;
select * from game where nameGame = "Far Cry 5";

select* from Gpu;
select* from Cpu;